---
export const prerender = false
import Layout from "../layouts/Layout.astro"
import Button from "../components/ui/button/Button.astro"
---

<Layout title="e29 | Contact">
  <main class="flex min-h-full w-full flex-col items-start">
    <section class="mx-auto w-full max-w-7xl px-2 sm:px-10">
      <h1
        class="font-eina01 w-full py-6 text-4xl font-semibold text-gray-900 sm:py-14 sm:text-5xl"
      >
        Contact
      </h1>
      <!-- Contact Form Section -->
      <div class="mx-auto max-w-2xl">
        <!-- Status Messages -->
        <div
          id="successMessage"
          class="mb-4 hidden rounded-lg border border-green-200 bg-green-50 p-4"
        >
          <p class="text-green-800">
            Merci! Votre message a été envoyé avec succès.
          </p>
        </div>
        <div
          id="errorMessage"
          class="mb-4 hidden rounded-lg border border-red-200 bg-red-50 p-4"
        >
          <p id="errorText" class="text-red-800">
            Une erreur s'est produite. Veuillez réessayer.
          </p>
        </div>

        <!-- Contact Form -->
        <form
          id="contactForm"
          class="rounded-lg border border-gray-200 bg-gray-50 p-6 shadow-sm"
          method="POST"
          action="/api/mail/send"
        >
          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <!-- First Name -->
            <div>
              <label
                for="firstName"
                class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
              >
                Prénom <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="firstName"
                name="firstName"
                required
                placeholder="Votre prénom"
                class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
              />
            </div>

            <!-- Last Name -->
            <div>
              <label
                for="lastName"
                class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
              >
                Nom <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="lastName"
                name="lastName"
                required
                placeholder="Votre nom"
                class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
              />
            </div>
          </div>

          <!-- Email -->
          <div class="mt-4">
            <label
              for="email"
              class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
            >
              Email <span class="text-red-500">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="votre.email@exemple.com"
              class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
            />
          </div>

          <!-- Phone (optional) -->
          <div class="mt-4">
            <label
              for="phone"
              class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
            >
              Téléphone
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder="+33 X XX XX XX XX"
              class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
            />
          </div>

          <!-- Subject -->
          <div class="mt-4">
            <label
              for="subject"
              class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
            >
              Sujet <span class="text-red-500">*</span>
            </label>
            <select
              id="subject"
              name="subject"
              required
              class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
            >
              <option value="">Choisissez un sujet</option>
              <option value="Question générale">Question générale</option>
              <option value="Événement / Spectacle"
                >Événement / Spectacle</option
              >
              <option value="Artiste / Collaboration"
                >Artiste / Collaboration</option
              >
              <option value="Location d'espace">Location d'espace</option>
              <option value="Partenariat">Partenariat</option>
              <option value="Presse / Médias">Presse / Médias</option>
              <option value="Autre">Autre</option>
            </select>
          </div>

          <!-- Message -->
          <div class="mt-4">
            <label
              for="message"
              class="font-eina04 mb-2 block text-lg font-medium text-gray-700"
            >
              Message <span class="text-red-500">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="6"
              placeholder="Décrivez votre demande, votre projet ou vos questions..."
              class="font-eina03 w-full rounded-lg border border-gray-300 px-3 py-2 text-lg transition-all duration-200 focus:border-gray-900 focus:ring-2 focus:ring-gray-900 focus:outline-none"
            ></textarea>
          </div>

          <!-- Privacy Notice -->
          <div class="mt-4">
            <div class="flex items-start gap-3">
              <input
                type="checkbox"
                id="privacy"
                name="privacy"
                required
                class="mt-1 h-4 w-4 rounded border-gray-300 text-gray-900 focus:ring-2 focus:ring-gray-900"
              />
              <label for="privacy" class="font-eina03 text-lg text-gray-600">
                J'accepte que mes données personnelles soient utilisées pour
                traiter ma demande. Les informations collectées sont utilisées
                uniquement pour vous répondre et ne sont jamais partagées avec
                des tiers. <span class="text-red-500">*</span>
              </label>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="mt-6 flex justify-end">
            <Button type="submit" intent="primary" size="small" id="submitBtn">
              Envoyer le message
            </Button>
          </div>
        </form>
      </div>
    </section>
  </main>
</Layout>

<script>
  const form = document.getElementById("contactForm") as HTMLFormElement
  const successMessage = document.getElementById("successMessage")
  const errorMessage = document.getElementById("errorMessage")
  const errorText = document.getElementById("errorText")
  const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement

  form.addEventListener("submit", async (e) => {
    e.preventDefault()

    // Hide previous messages
    successMessage?.classList.add("hidden")
    errorMessage?.classList.add("hidden")

    // Disable submit button
    submitBtn.disabled = true
    const originalText = submitBtn.textContent
    submitBtn.textContent = "Envoi en cours..."

    try {
      const formData = new FormData(form)
      const response = await fetch("/api/mail/send", {
        method: "POST",
        body: formData,
      })

      const data = await response.json()

      if (response.ok) {
        // Show success message
        successMessage?.classList.remove("hidden")
        // Reset form
        form.reset()
        // Scroll to success message
        successMessage?.scrollIntoView({ behavior: "smooth", block: "start" })
      } else {
        // Show error message
        errorText!.textContent =
          data.error || "Une erreur s'est produite. Veuillez réessayer."
        errorMessage?.classList.remove("hidden")
        errorMessage?.scrollIntoView({ behavior: "smooth", block: "start" })
      }
    } catch (error) {
      console.error("Form submission error:", error)
      errorText!.textContent =
        "Erreur de connexion. Veuillez vérifier votre connexion et réessayer."
      errorMessage?.classList.remove("hidden")
      errorMessage?.scrollIntoView({ behavior: "smooth", block: "start" })
    } finally {
      // Re-enable submit button
      submitBtn.disabled = false
      submitBtn.textContent = originalText
    }
  })
</script>
