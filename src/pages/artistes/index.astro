---
import Layout from "@layouts/Layout.astro"
import { formatArtistName } from "@lib/artists-helper"
import PageTopLayout from "@layouts/PageTopLayout.astro"
import { ArtistCard } from "@tina/components/ArtistCard.tsx"
import { getCollection } from "astro:content"

const artistCollection = (await getCollection("artist")).sort((a, b) =>
  a.data.lastName < b.data.lastName ? -1 : 1
)

console.log({ artistCollection })
console.log("üî•", artistCollection[0].data.tinaInfo)
---

<Layout title="e29 | Artistes" showBackToTop={true}>
  <main class="flex min-h-full w-full flex-col items-start">
    <PageTopLayout title="Artistes" />
    <!-- With padding container -->
    <div class="px-2 pb-2 sm:px-10 sm:pb-0">
      <!-- Introduction Text -->
      <section class="mb-12 w-full">
        <div class="max-w-4xl">
          <p class="font-eina03 mb-6 text-lg leading-relaxed text-gray-700">
            Les ateliers et studios d'artistes r√©sidents de l'Espace29 forment
            un lieu de travail communautaire unique, o√π la cr√©ativit√© et
            l'√©change sont au c≈ìur de la d√©marche artistique. Ces espaces,
            partag√©s ou individuels, offrent aux artistes un environnement
            propice √† la r√©flexion et √† la production, tout en favorisant la
            collaboration et le dialogue entre cr√©ateur-ices de diverses
            disciplines.
          </p>
          <p class="font-eina03 mb-6 text-lg leading-relaxed text-gray-700">
            L'Espace29 se veut ainsi un v√©ritable laboratoire de cr√©ation, o√π le
            collectif et le partage enrichissent les pratiques artistiques et
            permettent l'√©mergence de projets communs.
          </p>
        </div>
      </section>
    </div>

    <!-- Horizontal Scroll Section (no padding) -->
    <section
      id="horizontal-scroll-section"
      class="hidden h-screen w-full overflow-hidden sm:block"
    >
      <div id="artist-cards-wrapper" class="flex h-full flex-row flex-nowrap">
        <div class="h-full w-10 shrink-0"></div>

        {
          artistCollection.map(({ data: artistData }) => (
            <div class="w-[500px] min-w-[500px] shrink-0">
              <ArtistCard
                artist={artistData}
                grayscale="untilHover"
                className="h-full"
                href={`/artistes/${artistData.tinaInfo.filename}`}
              />
            </div>
          ))
        }
        <div class="h-full w-10 shrink-0"></div>
      </div>
    </section>

    <!-- Mobile Vertical Cards Section -->
    <section id="mobile-cards-section" class="block w-full px-2 pb-8 sm:hidden">
      <div class="flex flex-col gap-4">
        {
          artistCollection.map(({ data: artistData }) => (
            <div class="h-[500px] w-full">
              <ArtistCard
                artist={artistData}
                grayscale="untilHover"
                className="h-full"
                href={`/artistes/${artistData.tinaInfo.filename}`}
              />
            </div>
          ))
        }
      </div>
    </section>

    <!-- Vertical Content Section After Horizontal Scroll -->
    <section id="vertical-content" class="w-full"></section>
  </main>
</Layout>

<script>
  import { gsap } from "gsap"
  import { ScrollTrigger } from "gsap/ScrollTrigger"

  gsap.registerPlugin(ScrollTrigger)

  function initializeScrollAnimation() {
    // Only run on desktop (same breakpoint as the CSS)
    if (window.innerWidth < 640) {
      // Reset margin on mobile
      const verticalContent = document.getElementById("vertical-content")
      if (verticalContent) {
        gsap.set(verticalContent, { marginTop: 0 })
      }
      return
    }

    const horizontalSection = document.getElementById(
      "horizontal-scroll-section"
    )
    const cardsWrapper = document.getElementById("artist-cards-wrapper")
    const verticalContent = document.getElementById("vertical-content")

    if (!horizontalSection || !cardsWrapper || !verticalContent) return

    // Calculate scroll distance and deadzones
    const viewportWidth = window.innerWidth
    const scrollDistance = cardsWrapper.scrollWidth - viewportWidth

    // Add deadzones for comfortable reading
    const deadZone = viewportWidth * 0.1
    const totalScrollDistance = scrollDistance + deadZone * 2

    // Create timeline with deadzones
    const tl = gsap.timeline()

    // Deadzone before first card (no movement - user can read first card)
    tl.to(cardsWrapper, {
      duration: deadZone,
      ease: "none",
    })

    // Actual horizontal scroll between cards
    tl.to(cardsWrapper, {
      x: -scrollDistance,
      duration: scrollDistance,
      ease: "none",
    })

    // Deadzone after last card (no movement - user can read last card)
    tl.to(cardsWrapper, {
      duration: deadZone,
      ease: "none",
    })

    // Create ScrollTrigger for horizontal scroll with proper spacing
    ScrollTrigger.create({
      trigger: horizontalSection,
      start: "top top",
      end: () => `+=${totalScrollDistance}`,
      scrub: 1,
      pin: true,
      animation: tl,
      invalidateOnRefresh: true,
      anticipatePin: 1,
    })

    // Push vertical content down to prevent overlap
    gsap.set(verticalContent, {
      marginTop: totalScrollDistance,
    })
  }

  document.addEventListener("DOMContentLoaded", initializeScrollAnimation)

  // Refresh ScrollTrigger and reinitialize on window resize
  window.addEventListener("resize", () => {
    ScrollTrigger.getAll().forEach((trigger) => trigger.kill())
    ScrollTrigger.refresh()
    initializeScrollAnimation()
  })
</script>
