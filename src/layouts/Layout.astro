---
import Analytics from "@vercel/analytics/astro"
import SpeedInsights from "@vercel/speed-insights/astro"
import "@styles/global.css"

import Navbar from "@components/navigation/Navbar.astro"
import NavbarMobile from "@components/navigation/NavbarMobile.astro"
import Footer from "./Footer.astro"
import Icon from "@components/ui/icons/Icon.astro"

export interface Props {
  title?: string
  showBackToTop?: boolean
}

const { title = "Espace29", showBackToTop = false } = Astro.props
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- Eina01 fonts -->
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-Light.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-LightItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-Regular.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-RegularItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-SemiBold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-SemiboldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-Bold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina01-BoldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <!-- Eina02 fonts -->
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-Light.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-LightItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-Regular.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-RegularItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-SemiBold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-SemiboldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-Bold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina02-BoldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <!-- Eina03 fonts -->
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-Light.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-LightItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-Regular.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-RegularItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-SemiBold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-SemiboldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-Bold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina03-BoldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <!-- Eina04 fonts -->
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-Light.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-LightItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-Regular.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-RegularItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-SemiBold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-SemiboldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-Bold.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Eina/Eina04-BoldItalic.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <meta name="generator" content={Astro.generator} />
    <Analytics />
    <SpeedInsights />

    <title>{title}</title>
  </head>
  <body
    class="font-eina03 m-0 flex min-h-screen flex-col bg-gray-50 p-0 text-gray-900"
  >
    <header>
      <div class="hidden md:block">
        <Navbar />
      </div>
      <div class="block md:hidden">
        <NavbarMobile />
      </div>
    </header>
    <div class="grow">
      <slot />
    </div>
    <Footer />

    {
      showBackToTop && (
        <button
          id="back-to-top-nav-helper"
          class="pointer-events-none fixed right-4 bottom-4 z-20 hidden h-8 w-8 items-center justify-center rounded-lg bg-gray-900 text-white opacity-0 transition-all duration-300 hover:bg-gray-800 focus:bg-gray-800 focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 focus:outline-none sm:flex"
          aria-label="Return to top of page"
        >
          <Icon name="arrow-up-to-line" class="w-2" />
        </button>
      )
    }
  </body>
</html>

<script>
  function initializeBackToTop() {
    const backToTopButton = document.getElementById("back-to-top-nav-helper")
    if (!backToTopButton) return

    const showThreshold = 300 // Show button after scrolling 300px

    function toggleBackToTop() {
      if (!backToTopButton) return
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop

      if (scrollTop > showThreshold) {
        backToTopButton.classList.remove("opacity-0", "pointer-events-none")
        backToTopButton.classList.add("opacity-100", "pointer-events-auto")
      } else {
        backToTopButton.classList.add("opacity-0", "pointer-events-none")
        backToTopButton.classList.remove("opacity-100", "pointer-events-auto")
      }
    }

    function scrollToTop() {
      // Kill all GSAP ScrollTrigger instances temporarily to avoid conflicts
      if (window.ScrollTrigger) {
        window.ScrollTrigger.getAll().forEach((trigger) => trigger.kill())
      }

      // Scroll to top instantly
      window.scrollTo({
        top: 0,
        behavior: "instant",
      })

      // Reinitialize ScrollTrigger after a short delay
      if (window.ScrollTrigger) {
        setTimeout(() => {
          window.ScrollTrigger?.refresh()
          // Trigger custom event for pages to reinitialize their animations
          window.dispatchEvent(new CustomEvent("backToTopComplete"))
        }, 100)
      }
    }

    // Add event listeners
    window.addEventListener("scroll", toggleBackToTop)
    backToTopButton.addEventListener("click", scrollToTop)

    // Initial check
    toggleBackToTop()
  }

  // Initialize on DOM content loaded
  document.addEventListener("DOMContentLoaded", initializeBackToTop)
</script>
